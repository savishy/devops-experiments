---
#install docker on all hosts
- name: setup docker
  hosts: docker
  vars:
    # execute all commands as root
    ansible_become_user: root
    ansible_become_method: sudo
    ansible_become: true

  roles:
  - { role: ansible-roles/install-docker, docker_user: ubuntu }

- name: create registry
  hosts: registry
  vars:
    ansible_become_user: root
    ansible_become_method: sudo
    ansible_become: true
  roles:
  - {role: docker-registry, tags: ["registry"] }
# install and configure jenkins
- name: setup jenkins
  hosts: ci
  vars:
    # execute all commands as root
    ansible_become_user: root
    ansible_become_method: sudo
    ansible_become: true
    jenkins_java_opts: " -Xmx1024m -Djava.awt.headless=true -Dhudson.diyChunking=false -Djenkins.install.runSetupWizard=false"
  roles:
  - { role: ansible-roles/jenkins }
  - { role: ansible-roles/jenkins-plugins }
  - { role: ansible-roles/jenkins-cli, tags: ["cli","jobs"] }
  - { role: jenkins-jobs, tags: ["jobs"] }
